async function fetchWithCorsProxy(url) {
  try {
    // First try direct fetch with credentials (for same-origin URLs)
    if (url.includes('mypurecloud.ie')) {
      const directResponse = await authorizedFetch(url);
      if (directResponse.ok) {
        return await directResponse.json();
      }
    }
    
    // Fallback to CORS proxy for external URLs
    const proxyUrls = [
      `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
      `https://cors-anywhere.herokuapp.com/${url}`,
      `https://corsproxy.io/?${encodeURIComponent(url)}`
    ];
    
    for (const proxyUrl of proxyUrls) {
      try {
        const response = await fetch(proxyUrl, {
          method: 'GET',
          headers: {
            'Accept': 'application/json',
          }
        });
        
        if (response.ok) {
          return await response.json();
        }
      } catch (proxyError) {
        console.warn(`Proxy ${proxyUrl} failed:`, proxyError);
        continue;
      }
    }
    
    throw new Error('All CORS proxies failed');
  } catch (error) {
    console.error('All fetch attempts failed:', error);
    throw error;
  }
}
